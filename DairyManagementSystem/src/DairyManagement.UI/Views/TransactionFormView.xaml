<UserControl x:Class="DairyManagement.UI.Views.TransactionFormView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="Record Transaction" FontSize="32" FontWeight="Bold" 
                   Foreground="{StaticResource TextPrimaryBrush}" Margin="20,20,20,10"/>

        <ScrollViewer Grid.Row="1" Margin="20,0,20,20">
            <Border Background="White" Padding="30" CornerRadius="8">
                <StackPanel>
                    <!-- Customer Context (Read Only) -->
                    <TextBlock Text="Customer" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding CustomerName}" IsReadOnly="True" IsEnabled="False" Margin="0,0,0,20"/>

                    <TextBlock Text="Transaction Type" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <RadioButton Content="Product Sale" IsChecked="{Binding IsProductSale}" Margin="0,0,20,0"/>
                        <RadioButton Content="Advance Payment" IsChecked="{Binding IsAdvancePayment}"/>
                    </StackPanel>

                    <!-- Product Sale Fields -->
                    <StackPanel Visibility="{Binding IsProductSale, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Select Product" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <ComboBox ItemsSource="{Binding Products}" 
                                  SelectedItem="{Binding SelectedProduct}"
                                  DisplayMemberPath="ProductName"
                                  Margin="0,0,0,15"/>

                        <TextBlock Text="Quantity" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,15"/>

                        <TextBlock Text="Unit Price" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Amount, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,15"/>
                    </StackPanel>

                    <!-- Advance Payment Fields -->
                    <StackPanel Visibility="{Binding IsAdvancePayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Advance Amount" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Amount, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,15"/>
                    </StackPanel>

                    <TextBlock Text="Transaction Date" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <DatePicker SelectedDate="{Binding TransactionDate}" Margin="0,0,0,20"/>
                </StackPanel>
            </Border>
        </ScrollViewer>

        <!-- Actions -->
        <Border Grid.Row="2" Background="#F5F5F5" Padding="20">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Cancel" Style="{StaticResource SecondaryButton}" 
                        Command="{Binding CancelCommand}" Width="100" Margin="0,0,10,0"/>
                <Button Content="Save Transaction" Style="{StaticResource PrimaryButton}" 
                        Command="{Binding SaveCommand}" Width="150"/>
            </StackPanel>
        </Border>

        <!-- Loading Overlay -->
        <Grid Grid.RowSpan="3" Background="#88000000" 
              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="20"/>
                <TextBlock Text="Processing..." Foreground="White" HorizontalAlignment="Center" Margin="0,10,0,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
